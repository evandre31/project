{% extends 'base.html' %}

{% block content %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <h2>Django - Create User Sign Up</h2>
    <form method="post" data-validate-username-url="{% url 'accounts:validate_username' %}"
          data-validate-email-url="{% url 'accounts:validate_email_register' %}">
        {% csrf_token %}
        {{ form.as_p }}
        <span>
            <i class="fa fa-eye" aria-hidden="true" id="eye" onclick="toggle()"></i>
        </span><br><br>
        <button type="submit">Sign up - register</button>
    </form>

    <style>.classe_message {
        background-color: #1bbb41;
    }

    span {
        right: 15px;
        transform: translate(0, -50%);
        top: 50%;
        cursor: pointer;
    }

    .fa {
        font-size: 20px;
        color: #7a797e;
    }
    </style>
{% endblock %}

{% block javascript %}
    {# password same or not #}
    <script>{# password same or not #}
    password1 = document.getElementById('id_password1'); // password same or not
    password2 = document.getElementById('id_password2');
    message = document.createElement("span");
    message.id = 'message';
    message.classList.add('classe_message');
    message2 = message.cloneNode(true);
    password1.parentNode.appendChild(message);
    password2.parentNode.appendChild(message2);
    $('#id_password1, #id_password2').on('keyup', function () {     // password same or not
        if ($('#id_password1').val() === $('#id_password2').val()) {
            $('#message,classemessage').html('password same').css('color', 'green');
        } else {# password same or not #}
            $('#message,classemessage').html('password not same').css('color', 'red');
    });
    </script> {# password same or not #}
    <style>.classe_message {
        background-color: #1bbb41;
    }</style>

    <!-- check username -->
    <script> {# debut check username #}
    $('#id_username').on('keyup input', function CheckUsername() {    // cibler event de input
        const username = $(this).val(); //val de input qui va être envoyé au view
        const username_Ele = document.getElementById('id_username'); // cibler input
        const message_user = document.createElement("span"); //creation element span et le ciblé
        message_user.id = 'id_message_user'; //creation element span : ajout attr
        message_user.classList.add('classe_message_user'); //creation element span  : ajout attr
        message_user.style = "display: none"; //creation element span  : ajout attr
        username_Ele.parentNode.appendChild(message_user); //ajout element crée aprés input ciblé
        const form = $(this).closest("form"); //cible form
        $.ajax({
            url: form.attr("data-validate-username-url"),
            data: form.serialize(),
            dataType: 'json',
            success: function (data) {
                if (data.is_taken) {
                    $('#id_message_user').text(data.error_message);//text du span ajouté venu de view
                    $("#id_message_user").css("display", "block");
                } else {
                    $("#id_message_user").css("display", "none");
                }
            }
        });
    });
    </script> {# end check username #}

    <!-- check email -->
    <script> {# debut check email #}
    $('#id_email').on('keyup input', function CheckEmail() { // check email
        const email = $(this).val();
        const email_Ele = document.getElementById('id_email');
        const message_email = document.createElement("span");
        message_email.id = 'id_message_email';
        message_email.classList.add('classe_message_email');
        message_email.style = "display: none";
        email_Ele.parentNode.appendChild(message_email);
        const form = $(this).closest("form");
        $.ajax({
            url: form.attr("data-validate-email-url"),
            data: form.serialize(),
            dataType: 'json',
            success: function (data) {
                if (data.is_taken) {
                    $('#id_message_email').text(data.error_message);
                    $("#id_message_email").css("display", "block");
                } else {
                    $("#id_message_email").css("display", "none");
                }
            }
        });
    });
    </script> {#  end check email #}

    {#  Show/Hide Password Toggle With Javascript #}
    <script>
        let state = false;
        function toggle() {
            if (state) {
                document.getElementById("id_password1").setAttribute("type", "password");
                document.getElementById("id_password2").setAttribute("type", "password");
                document.getElementById("eye").style.color = '#91922b';
                state = false;
            } else {
                document.getElementById("id_password1").setAttribute("type", "text");
                document.getElementById("id_password2").setAttribute("type", "text");
                document.getElementById("eye").style.color = '#1b1fef';
                state = true;
            }
        }
    </script>{#  end Show/Hide Password Toggle With Javascript #}
{% endblock javascript %}